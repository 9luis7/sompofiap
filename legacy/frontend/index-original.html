<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sompo Seguros - Sistema de Monitoramento</title>
    
    <!-- Meta tags para SEO e compartilhamento -->
    <meta name="description" content="Sistema de monitoramento inteligente para Sompo Seguros">
    <meta name="keywords" content="seguros, monitoramento, log√≠stica, tecnologia">
    <meta name="author" content="Sompo Seguros">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- MapLibre (fallback simples, sem chave) -->
    <link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet" />
    
            <!-- Custom Styles -->
        <link rel="stylesheet" href="styles.css">
        <link rel="stylesheet" href="ux-styles.css">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" as="style">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">
                <i class="fas fa-shield-alt"></i>
                <span>SOMPO SEGUROS</span>
            </div>
            <div class="spinner-ring"></div>
            <p>Carregando sistema de monitoramento...</p>
            <div class="loading-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="loading-progress"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="screen active" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);">
        <!-- Dark Mode Toggle -->
        <div class="theme-toggle" id="login-theme-toggle">
            <div class="theme-toggle-switch" id="login-theme-switch">
                <i class="fas fa-sun icon sun"></i>
                <i class="fas fa-moon icon moon"></i>
            </div>
        </div>
        
        <div class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="logo">
                        <div class="logo-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h1>SOMPO SEGUROS</h1>
                        <p>Sistema de Monitoramento Inteligente</p>
                    </div>
                </div>
                
                <form class="login-form" id="login-form" style="position: relative; z-index: 1000;">
                    <div class="form-group">
                        <label for="username">
                            <i class="fas fa-user"></i>
                            Usu√°rio
                        </label>
                        <input type="text" id="username" name="username" required style="position: relative; z-index: 1001;">
                    </div>
                    
                    <div class="form-group">
                        <label for="password">
                            <i class="fas fa-lock"></i>
                            Senha
                        </label>
                        <input type="password" id="password" name="password" required style="position: relative; z-index: 1001;">
                    </div>
                    
                    <button type="submit" class="btn-login" onclick="if(window.authManager) window.authManager.handleLogin(); return false;" style="position: relative; z-index: 1002;">
                        <i class="fas fa-sign-in-alt"></i>
                        Entrar no Sistema
                    </button>
                </form>
                
                <div class="login-footer">
                    <p>¬© 2024 Sompo Seguros. Todos os direitos reservados.</p>
                    <div class="demo-credentials">
                        <h4>Credenciais de Administrador:</h4>
                        <p><strong>Admin:</strong> admin / admin123</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboard-screen" class="screen">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <span>SOMPO SEGUROS</span>
                    <div class="system-status">
                        <div class="status-indicator online"></div>
                        <span>Sistema Online</span>
                    </div>
                </div>
                
                <div class="user-info">
                    <div class="user-profile">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-details">
                            <span class="user-name" id="user-name">Usu√°rio</span>
                            <span class="user-role" id="user-role">Operador</span>
                        </div>
                    </div>
                    
                    <!-- Dark Mode Toggle -->
                    <div class="theme-toggle" id="dashboard-theme-toggle">
                        <span class="theme-toggle-label">Modo Escuro</span>
                        <div class="theme-toggle-switch" id="dashboard-theme-switch">
                            <i class="fas fa-sun icon sun"></i>
                            <i class="fas fa-moon icon moon"></i>
                        </div>
                    </div>
                    
                    <button class="btn-help" onclick="window.uxImprovements.showHelpCenter()" data-tooltip="Centro de Ajuda">
                        <i class="fas fa-question-circle"></i>
                    </button>
                    <button class="btn-logout" onclick="window.authManager.logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        Sair
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="navigation">
            <button class="nav-btn active" data-tab="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                Dashboard
            </button>
            <button class="nav-btn" data-tab="map">
                <i class="fas fa-map-marked-alt"></i>
                Mapa
            </button>
            <button class="nav-btn" data-tab="shipments">
                <i class="fas fa-truck"></i>
                Cargas
            </button>
            <button class="nav-btn" data-tab="alerts">
                <i class="fas fa-exclamation-triangle"></i>
                Alertas
            </button>
            <button class="nav-btn" data-tab="users">
                <i class="fas fa-users"></i>
                Usu√°rios
            </button>
            <button class="nav-btn" data-tab="vehicles">
                <i class="fas fa-car"></i>
                Ve√≠culos
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <!-- Statistics Grid -->
                <div class="stats-grid">
                    <div class="stat-card active-shipments">
                        <div class="stat-icon">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="active-shipments-count">0</h3>
                            <p>Cargas Ativas</p>
                            <div class="stat-trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span>+12%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card total-alerts">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-alerts-count">0</h3>
                            <p>Total de Alertas</p>
                            <div class="stat-trend down">
                                <i class="fas fa-arrow-down"></i>
                                <span>-8%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card high-risk-zones">
                        <div class="stat-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="high-risk-zones-count">0</h3>
                            <p>Zonas de Alto Risco</p>
                            <div class="stat-trend neutral">
                                <i class="fas fa-minus"></i>
                                <span>0%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card fleet-utilization">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="fleet-utilization-percentage">0%</h3>
                            <p>Utiliza√ß√£o da Frota</p>
                            <div class="stat-trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span>+5%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- KPIs espec√≠ficos para seguradora -->
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="kpi-loss-ratio">--%</h3>
                            <p>Sinistralidade</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="kpi-average-premium">R$ --</h3>
                            <p>Pr√™mio M√©dio</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-stopwatch"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="kpi-response-time">-- min</h3>
                            <p>Tempo M√©dio de Resposta</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="kpi-critical-risk-index">--%</h3>
                            <p>√çndice de Risco Cr√≠tico</p>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-section">
                    <div class="charts-grid">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h4><i class="fas fa-chart-pie"></i> Distribui√ß√£o de Risco</h4>
                                <div class="chart-actions">
                                    <button class="btn-chart" title="Atualizar">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                    <button class="btn-chart" title="Expandir">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                            </div>
                            <canvas id="riskChart" width="400" height="300"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <div class="chart-header">
                                <h4><i class="fas fa-chart-bar"></i> Alertas por Severidade</h4>
                                <div class="chart-actions">
                                    <button class="btn-chart" title="Atualizar">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                    <button class="btn-chart" title="Expandir">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                            </div>
                            <canvas id="severityChart" width="400" height="300"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <div class="chart-header">
                                <h4><i class="fas fa-chart-line"></i> Tend√™ncia de Alertas (24h)</h4>
                                <div class="chart-actions">
                                    <button class="btn-chart" title="Atualizar"><i class="fas fa-sync-alt"></i></button>
                                </div>
                            </div>
                            <canvas id="alerts-trend-chart" width="400" height="300"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Content -->
                <div class="dashboard-content">
                    <div class="map-section">
                        <div class="section-header">
                            <h3><i class="fas fa-map-marked-alt"></i> Mapa em Tempo Real</h3>
                            <div class="section-actions">
                                <button class="btn-map-action" onclick="window.mapManager?.refreshMap()">
                                    <i class="fas fa-sync-alt"></i>
                                    Atualizar
                                </button>
                                <button class="btn-view-all" onclick="window.app.showTab('map')">
                                    Ver Completo
                                </button>
                            </div>
                        </div>
                        <div id="dashboard-map" class="map-container">
                            <div class="map-loading">
                                <div class="loading-spinner"></div>
                                <p>Carregando mapa...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alerts-section">
                        <div class="section-header">
                            <h3><i class="fas fa-exclamation-triangle"></i> Alertas Recentes</h3>
                            <button class="btn-view-all" onclick="window.app.showTab('alerts')">
                                Ver Todos
                            </button>
                        </div>
                        <div id="recent-alerts" class="alerts-list">
                            <!-- Alertas ser√£o carregados dinamicamente -->
                        </div>
                    </div>
                </div>

                <!-- Active Shipments Section -->
                <div class="active-shipments-section">
                    <div class="section-header">
                        <h3><i class="fas fa-truck"></i> Cargas Ativas</h3>
                        <button class="btn-view-all" onclick="window.app.showTab('shipments')">
                            Ver Todas
                        </button>
                    </div>
                    <div id="active-shipments" class="shipments-grid">
                        <!-- Cargas ser√£o carregadas dinamicamente -->
                    </div>
                </div>
            </div>

            <!-- Map Tab -->
            <div id="map-tab" class="tab-content">
                <div class="page-header">
                    <h2><i class="fas fa-map-marked-alt"></i> Mapa de Monitoramento</h2>
                    <div class="map-controls">
                        <button class="btn-primary" onclick="window.mapManager?.refreshMap()">
                            <i class="fas fa-sync-alt"></i>
                            Atualizar
                        </button>
                    </div>
                </div>
                <div id="main-map" class="map-container">
                    <div class="map-loading">
                        <div class="loading-spinner"></div>
                        <p>Carregando mapa...</p>
                    </div>
                </div>
            </div>

            <!-- Shipments Tab -->
            <div id="shipments-tab" class="tab-content">
                <div class="page-header">
                    <h2><i class="fas fa-truck"></i> Gerenciamento de Cargas</h2>
                    <button class="btn-primary" onclick="showShipmentModal()">
                        <i class="fas fa-plus"></i>
                        Nova Carga
                    </button>
                </div>
                <div id="shipments-list" class="data-list">
                    <!-- Lista de cargas ser√° carregada dinamicamente -->
                </div>
            </div>

            <!-- Alerts Tab -->
            <div id="alerts-tab" class="tab-content">
                <div class="page-header">
                    <h2><i class="fas fa-exclamation-triangle"></i> Sistema de Alertas</h2>
                    <button class="btn-primary" onclick="showAlertModal()">
                        <i class="fas fa-plus"></i>
                        Novo Alerta
                    </button>
                </div>
                <div id="alerts-list" class="data-list">
                    <!-- Lista de alertas ser√° carregada dinamicamente -->
                </div>
            </div>

            <!-- Users Tab -->
            <div id="users-tab" class="tab-content">
                <div class="page-header">
                    <h2><i class="fas fa-users"></i> Gerenciamento de Usu√°rios</h2>
                    <button class="btn-primary" onclick="showUserModal()">
                        <i class="fas fa-plus"></i>
                        Novo Usu√°rio
                    </button>
                </div>
                <div id="users-list" class="data-list">
                    <!-- Lista de usu√°rios ser√° carregada dinamicamente -->
                </div>
            </div>

            <!-- Vehicles Tab -->
            <div id="vehicles-tab" class="tab-content">
                <div class="page-header">
                    <h2><i class="fas fa-car"></i> Gerenciamento de Ve√≠culos</h2>
                    <button class="btn-primary" onclick="showVehicleModal()">
                        <i class="fas fa-plus"></i>
                        Novo Ve√≠culo
                    </button>
                </div>
                <div id="vehicles-list" class="data-list">
                    <!-- Lista de ve√≠culos ser√° carregada dinamicamente -->
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="modal-overlay" class="modal-overlay" style="display:none;">
        <div id="modal-content" class="modal-content">
            <!-- Conte√∫do do modal ser√° carregado dinamicamente -->
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- MapLibre GL JS -->
    <script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Application Scripts -->
    <script src="config.js"></script>
    <script src="theme-manager.js"></script>
    <script src="ux-improvements.js"></script>
    <script src="auth.js"></script>
    <script src="dashboard.js"></script>
    <script src="map.js"></script>
    <script src="shipments.js"></script>
    <script src="alerts.js"></script>
    <script src="users.js"></script>
    <script src="vehicles.js"></script>
    <script src="app.js"></script>

    <!-- Initialization Script -->
    <script>
        // Remover tela de loading imediatamente ap√≥s carregar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM carregado, removendo tela de loading...');
            
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                // Remover imediatamente
                loadingScreen.style.display = 'none';
                console.log('‚úÖ Tela de loading removida');
            }
        });

        // Verificar se todos os managers est√£o dispon√≠veis
        window.addEventListener('load', function() {
            console.log('üöÄ Todos os scripts carregados');
            
            const managers = ['authManager', 'app', 'dashboardManager'];
            const missingManagers = managers.filter(manager => !window[manager]);
            
            if (missingManagers.length > 0) {
                console.warn('‚ö†Ô∏è Managers n√£o encontrados:', missingManagers);
            } else {
                console.log('‚úÖ Todos os managers carregados com sucesso');
            }
            
            // Garantir que a tela de loading seja removida
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                loadingScreen.style.display = 'none';
            }
        });
    </script>
</body>
</html>
